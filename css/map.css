/* ===================== Leaflet Map ===================== */
:root {
  --map-min-h: 320px;
  --map-ideal-h: 58vh;
  --map-max-h: 760px;
}

.leaflet-map {
  inline-size: 100%;
  block-size: clamp(var(--map-min-h), var(--map-ideal-h), var(--map-max-h));
  border-radius: 14px;
  border: 1px solid var(--border);
  overflow: hidden;
  isolation: isolate;
  touch-action: manipulation;
}

.leaflet-interactive {
  cursor: pointer;
}

.prov-tip {
  direction: ltr;
}

.prov-tip.rtl {
  direction: rtl;
}

.map-tooltip {
  position: fixed;
  pointer-events: none;
  z-index: 9999;

  /* شیشه‌ای */
  background: color-mix(in oklab, var(--card) 60%, transparent);
  border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
  backdrop-filter: blur(10px) saturate(140%);
  -webkit-backdrop-filter: blur(10px) saturate(140%);

  color: var(--text);
  padding: 8px 12px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 13px;
  box-shadow:
    0 8px 24px color-mix(in oklab, var(--shadow) 60%, transparent),
    0 1px 0 color-mix(in oklab, #fff 30%, transparent) inset;

  /* دقیقا بالای نشانگر: مبنا وسط-پایین */
  transform: translate(-50%, calc(-100% - 10px));
  opacity: 0;
  transition: opacity .12s ease, transform .12s ease;
}

.map-tooltip[aria-hidden="false"] {
  opacity: 1;
}

.map-tooltip.rtl {
  direction: rtl;
}

.leaflet-control-zoom a:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 30%, transparent);
}

.map-tooltip[aria-hidden="true"] {
  opacity: 0;
}

.map-tooltip::after {
  content: "";
  position: absolute;
  left: 50%;
  bottom: -6px;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: color-mix(in oklab, var(--card) 60%, transparent);
  filter: drop-shadow(0 1px 0 color-mix(in oklab, var(--border) 70%, transparent));
}


/* Province polygons (use Leaflet's class) */
.leaflet-container .leaflet-interactive {
  cursor: pointer;
  transition: fill .15s ease, stroke .15s ease, filter .15s ease;
  outline: none;
}

/* فوکوس کیبورد برای دسترسی‌پذیری */
.leaflet-container path[tabindex="0"]:focus {
  filter: drop-shadow(0 0 6px color-mix(in oklab, var(--primary) 35%, transparent));
}

/* Hover fallback (JS هم در رویداد mouseover استایل می‌دهد) */
.leaflet-container .leaflet-interactive:hover {
  filter: drop-shadow(0 0 4px color-mix(in oklab, var(--primary) 25%, transparent));
}

/* Attribution unobtrusive */
.leaflet-control-attribution {
  background: color-mix(in oklab, var(--card) 75%, transparent);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding-inline: 8px;
}

/* Zoom controls */
.leaflet-control-zoom a {
  background: var(--bg-soft);
  border: 1px solid var(--border);
  color: var(--text);
}

.leaflet-control-zoom a:hover {
  background: color-mix(in oklab, var(--primary) 12%, var(--bg-soft));
  border-color: color-mix(in oklab, var(--primary) 30%, var(--border));
}